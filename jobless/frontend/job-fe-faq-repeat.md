---
title: job-fe-faq-repeat
tags: [engineering, faq, frontend, job, repeat]
created: '2021-09-21T19:48:40.202Z'
modified: '2021-10-10T09:18:22.446Z'
---

# job-fe-faq-repeat

# guide

# 从输入URL到页面展示发生了什么？

## 一、URL到底是啥

- URL（Uniform Resource Locator），统一资源定位符，用于定位互联网上资源，俗称网址。
  - scheme://host.domain:port/path/filename

## 二、域名解析（DNS）

- 与IP地址的一组纯数字相比，用字母配合数字的表示形式来指定域名更符合人类的记忆习惯

- 浏览器如何通过域名去查询 URL 对应的 IP 呢
  - 浏览器缓存：浏览器会按照一定的频率缓存 DNS 记录。
操作系统缓存：如果浏览器缓存中找不到需要的 DNS 记录，那就去操作系统中找。
  - 路由缓存：路由器也有 DNS 缓存。
  - ISP 的 DNS 服务器：ISP 是互联网服务提供商(Internet Service Provider)的简称，ISP 有专门的 DNS 服务器应对 DNS 查询请求。
  - 根服务器：ISP 的 DNS 服务器还找不到的话，它就会向根服务器发出请求，进行递归查询（DNS 服务器先问根域名服务器.com 域名服务器的 IP 地址，然后再问.baidu 域名服务器，依次类推）

- 浏览器通过向DNS服务器发送域名，DNS服务器查询到与域名相对应的 IP 地址，然后返回给浏览器，浏览器再将 IP 地址打在协议上，同时请求参数也会在协议搭载，然后一并发送给对应的服务器

## 三、TCP 三次握手

- 客户端发送一个带 SYN=1，Seq=X 的数据包到服务器端口（第一次握手，由浏览器发起，告诉服务器我要发送请求了）
- 服务器发回一个带 SYN=1， ACK=X+1， Seq=Y 的响应包以示传达确认信息（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）
- 客户端再回传一个带 ACK=Y+1， Seq=Z 的数据包，代表“握手结束”（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）

- 为啥需要三次握手
  - 为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误

## 四、发送 HTTP 请求

- 请求报文由请求行（request line）、请求头（header）、请求体组成
- 请求行包含请求方法、URL、协议版本
- 请求头包含请求的附加信息，由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。

- 请求体，可以承载多个请求参数的数据，包含回车符、换行符和请求数据，并不是所有请求都具有请求数据。

## 五、服务器处理请求并返回 HTTP 报文

- 服务器是网络环境中的高性能计算机
  - 后台开发现在有很多框架，但大部分都还是按照 MVC 设计模式进行搭建的。

- 首先浏览器发送过来的请求先经过控制器，控制器进行逻辑处理和请求分发，接着会调用模型，这一阶段模型会获取 redis db 以及 MySQL 的数据，
  - 获取数据后将渲染好的页面，响应信息会以响应报文的形式返回给客户端，最后浏览器通过渲染引擎将网页呈现在用户面前。

- http 响应报文
  - 由响应行（request line）、响应头部（header）、响应主体三个部分组成
- 响应行包含：协议版本，状态码，状态码描述
- 响应头部包含响应报文的附加信息，由 名/值 对组成
- 响应主体包含回车符、换行符和响应返回数据，并不是所有响应报文都有响应数据

## 七、断开连接

- 当数据传送完毕，需要断开 tcp 连接，此时发起 tcp 四次挥手。
- 发起方向被动方发送报文，Fin、Ack、Seq，表示已经没有数据传输了。并进入 FIN_WAIT_1 状态。(第一次挥手：由浏览器发起的，发送给服务器，我请求报文发送完了，你准备关闭吧)
- 被动方发送报文，Ack、Seq，表示同意关闭请求。此时主机发起方进入 FIN_WAIT_2 状态。(第二次挥手：由服务器发起的，告诉浏览器，我请求报文接受完了，我准备关闭了，你也准备吧)
- 被动方向发起方发送报文段，Fin、Ack、Seq，请求关闭连接。并进入 LAST_ACK 状态。(第三次挥手：由服务器发起，告诉浏览器，我响应报文发送完了，你准备关闭吧)
- 发起方向被动方发送报文段，Ack、Seq。然后进入等待 TIME_WAIT 状态。被动方收到发起方的报文段以后关闭连接。发起方等待一定时间未收到回复，则正常关闭。(第四次挥手：由浏览器发起，告诉服务器，我响应报文接受完了，我准备关闭了，你也准备吧)

## 六、浏览器解析渲染页面

### 1. 根据 HTML 解析 DOM 树

- 根据 HTML 的内容，将标签按照结构解析成为 DOM 树，DOM 树解析的过程是一个深度优先遍历。即先构建当前节点的所有子节点，再构建下一个兄弟节点。
- 在读取 HTML 文档，构建 DOM 树的过程中，若遇到 script 标签，则 DOM 树的构建会暂停，直至脚本执行完毕。

### 2. 根据 CSS 解析生成 CSS 规则树

- 解析 CSS 规则树时 js 执行将暂停，直至 CSS 规则树就绪。

- 浏览器在 CSS 规则树生成之前不会进行渲染。

### 3. 结合 DOM 树和 CSS 规则树，生成渲染树

- DOM 树和 CSS 规则树全部准备好了以后，浏览器才会开始构建渲染树。
- 精简 CSS 并可以加快 CSS 规则树的构建，从而加快页面相应速度。

### 4. 根据渲染树计算每一个节点的信息（布局）

- 布局：通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸
- 回流：在布局完成后，发现了某个部分发生了变化影响了布局，那就需要倒回去重新渲染。

### 5. 根据计算好的信息绘制页面

- 绘制阶段，系统会遍历呈现树，并调用呈现器的“paint”方法，将呈现器的内容显示在屏幕上。
- 回流：某个元素的尺寸发生了变化，则需重新计算渲染树，重新渲染。
- 重绘：某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的重绘。
# 首屏加载优化

## [首屏加载速度慢的怎么解决](https://vue3js.cn/interview/vue/first_page_time.htmlSPA)

- 首屏时间（First Contentful Paint），指的是浏览器从响应用户输入网址地址，到首屏内容渲染完成的时间，此时整个网页不一定要全部渲染完成，但需要展示当前视窗需要的内容
- 关于计算首屏时间
  - 通过DOMContentLoad或者performance来计算出首屏时间

```JS
// 方案一：
document.addEventListener('DOMContentLoaded', (event) => {
  console.log('first contentful painting');
});
// 方案二：
performance.getEntriesByName("first-contentful-paint")[0].startTime

// performance.getEntriesByName("first-contentful-paint")[0]
// 会返回一个 PerformancePaintTiming的实例，结构如下：
{
  name: "first-contentful-paint",
  entryType: "paint",
  startTime: 507.80000002123415,
  duration: 0,
};
```

- 首屏加载慢的原因
  - 资源文件体积是否过大
  - 资源是否重复发送请求去加载了
  - 加载脚本的时候，渲染内容堵塞了
  - 网络延时问题

- 解决方案
- 减小入口文件积
  - 常用的手段是路由懒加载，把不同路由对应的组件分割成不同的代码块，待路由被请求的时候会单独打包路由
- 静态资源本地缓存
  - 采用HTTP缓存，设置Cache-Control，Last-Modified，Etag等响应头
  - 采用Service Worker离线缓存
  - 前端合理利用localStorage
- UI框架按需加载
  - 只import需要的组件，而不是整个组件库
- 图片资源的压缩
  - 是对页面性能影响最大的因素
  - 对于所有的图片资源，我们可以进行适当的压缩
  - 对页面上使用到的icon，可以使用雪碧图，将众多小图标合并到同一张图上，用以减轻http请求压力。
- 组件重复打包
  - 在webpack的config文件中，修改CommonsChunkPlugin的配置
  - minChunks为3表示会把使用3次及以上的包抽离出来，放进公共依赖文件，避免了重复加载组件
- 开启GZip压缩、minify
  - compression-webpack-plugin
- 使用SSR
  - 组件或页面通过服务器生成html字符串，再发送到浏览器

- 减小资源体积
  - Vue的异步组件、Vue-Router路由懒加载
  - 合并资源
  - 文件压缩 
  - webpack 配置Gzip 压缩 （compression-webpack-plugin）， nginx 配置服务开启gzip
  - 图片懒加载
  - 替代资源（预先加载小内存图片）


- 优化资源加载速度
  - 缓存
  - cdn
  - 合并请求
  - http2

- 优化dom渲染时间
  - 使用 defer async 加载js 优先级低的 可以使用 defer
  - preload 使用提高加载权重
