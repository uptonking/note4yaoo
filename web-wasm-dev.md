---
title: web-wasm-dev
tags: [dev, wasm]
created: '2020-12-31T19:17:26.544Z'
modified: '2021-01-01T20:10:51.125Z'
---

# web-wasm-dev

## guide

## pieces

## discuss

- ### [如何看待 WebAssembly 这门技术？](https://www.zhihu.com/question/362649730/answers/updated)
- 我不太认为 WASM 是值得前端 all in 的技术，概括地说几点问题：
  - WASM运行时性能在原理上就是受限的，跑不到真正的汇编级别。
    - Rust 编译到 WASM 后有不小的性能损失，极致优化后的 JS 不会输它多少
    - 所以真实世界 benchmark 里，WASM 往往并没有压倒性的优势。
    - 不要以为这是因为它不够成熟，而是原理上就决定了。
  - WASM不是计算密集型应用的唯一救星。
    - 对于真正高度并行且精度要求不高的算法，**用WebGL做GPU加速往往更快**，然后才是WASM这种CPU上运行的字节码。
  - 嵌入 WASM 函数到 JS，未必就能提高性能。
    - JS 自身的 JIT 已经内置了机器码级的优化，你手动把算法重写成 C，未必比 Happy Path 上的 JIT 更快。
  - JS 与 WASM 的双向调用并不像 Python 嵌入 C 那么简单，
    - 你不能随便把 JS 里的对象直接交给 WASM，至于喊着打通一切运行时类型的 WASM Interface Types 才刚有了个影子。
  - 主流前端UI框架未必值得用 WASM 重写，
    - 它们的场景是 IO 密集的，换语言彻底重写的投入产出比很难说。
    - 按相同逻辑，既然 JVM 比 V8 快，你愿意用 Java 重写 Node 服务吗？
  - WASM生态跟前端工具链基本无关，
    - 它的 Emscripten 工具链搞的完全就是 C++ 系语言交叉编译，从编译器到依赖库都完全跟 JS 这一套无关。
  - [一个白学家眼里的WebAssembly](https://zhuanlan.zhihu.com/p/102692865)
  - 我不是说WASM不好，它非常适合把原生应用搬到Web上 
    - 编译出一个C++应用的Web版就像把它编译到安卓一样，换一套工具链就行。
    - 但是，不要把 WASM 当作一切前端性能问题的灵丹妙药，更不要觉得把你的 JS 随便用 Rust 重写一下就能快几倍。
    - 还是那句老话，没有银弹
- 我们认为WebAssembly的潜力在服务端。
  - 与Java 和 JavaScript 引擎相比，WASM 通过LLVM 工具链支持20多种编程语言，从而让开发人员有选择语言工具的自由
  - 同时，WASM 可以轻松支持CPU、GPU、 AI 优化芯片和FPGA 等硬件功能。
  - 与Docker之类的容器相比，它为开发人员提供了更抽象的代码执行环境，从而提高了开发效率。
    - 它可以直接部署代码和应用程序，而不必启动操作系统。
    - Wasm 程序不需修改，就可以在不同的操作系统上运行。
    - 这与当今的云原生微服务架构配合得很好。
  - WASM 消耗的内存和资源比操作系统级别的容器少得多。
- 我认为wasm的价值非常大
  1. 首先wasm得到了很多大厂的支持，无论是typescript还是c/c++还是go语言都能编译到wasm；
  2. 然后wasm虚拟的实现代码只要几千行，可以根据不同的需求快速定制虚拟机；所以wasm做嵌入式是非常方便的；
  3. 其次wasm可以反编译到很多其他语言，加强了语言的互通。
  4. 至于在浏览器上跑wasm，他绝对不是用来操作dom和css的，wasm最早的demo就是启动一个虚幻场景，在曾经页游盛行的时代，wasm的价值非常明显。只不过在移动互联网的浪潮下没落了。
  5. 当前wasm已经实现了aot编译，性能以及和c相当，从而所以语言编译到wasm在静态化成为更好的方案。
  6. 我预言下一步wasm将成为全平台的中间语言，各种新旧语言都能在wasm字节码上执行，成为手机游戏热更新的新宿主（取代当下的lua和js）。甚至很多app都将其编译到 wasm 字节码执行，实现真正一切代码的跨一切跨平台包括web。
- wasm当前现状
  1. 当前wasm在浏览器上通过浏览器jit执行。性能和js的jit差不多。
  2. wasm在非web环境可以解释执行，jit执行，aot编译执行。性能是aot大于 jit 大于 解释。
  3. 在iOS只能解释或aot，不能jit，iOS系统不允许执行动态生成的代码页。
- 没什么好说的，目前我只想告诉你wasm性能不高。。。。
  - 仅有的价值就是方便js复用其他代码现有的算法，没有平台api依赖那种
- WASM意义重大。
  - 原本只有JavaScript是跨所有平台的，C++/C#差一个浏览器，现在这个问题没有了。老旧代码可以继续拿来用。
- 在我的Wasm的实践来说，Wasm对于前端开发来说是解放了一些特殊能力，使得一些边缘计算成为了可能。
  - Web前端的算法能力和数据处理能力在对于C++是比较薄弱的，wasm使得很多C++实现的算法很方便的移植到了浏览器中，
    - 使得JS只需要调用调用方法就可能实现以前JS很难实现的功能，比如我前段时间做的扣脸功能。
- 而对后端来说，Wasm主要是解决了后端开发C++库的一些心智负担。
  - 对于后端来说，如果要使用一个C++库则需要安装这个C++库的依赖到线上环境，
  - 其次再使用node-gyp来构建的库，这样就很可能C++库版本依赖发生变化导致的各种各样的问题，无疑是加大了后端开发者的心智负担，
  - 而如果使用Wasm则只需要一次构建，不再需要安装C++依赖库
  - 其实不管是nan还是napi或多或少都会因为V8代码的结构调整收到影响或导致不可用，可以说有可能你node10能使用的C++扩展到node12居然就不可用了
  - 那么无疑Wasm是更好的解决方案，可以使nodejs后端开发不再关注于V8或C++库的一些变化，而更关注于JS相关的东西
- WebAssembly 是让其他编译型语言进入前端的重要技术，前端不只有JS了！
  - 我正在开发的 Ant Design WebAssembly组件库
  - 我用Blazor这个框架，实现Ant Design，运行在 WebAssembly 环境

- ### [WebAssembly 的出现是否会取代 JavaScript？](https://www.zhihu.com/question/322007706/answers/updated)
- 这个说法不准确，wasm只是一个字节码标准，人们可以基于这个标准开发高级语言。
  - 类似jvm一样，很多语言可以编译成jvm字节码，从而使用jvm平台。
  - wasm出现的意义是使用其他语言开发web app成为可能。
  - 之前也有其他语言，比如typescript开发，但是都是把代码编译成JavaScript运行，本质上还是使用的JavaScript. 个人认为JavaScript以后会作为浏览器默认支持的高级语言一直存在下去，
  - 但是wasm出现可以使基于web的开发工具出现百花齐放的状态，web端可能出现类似Java这样适合大型项目的静态类型语言。
- 不论是短期还是长期，我都坚定地认为JS不会被替代。
  - 短期上WASM显然无法替代JS
  - 工具链调试困难、包体积庞大冗余、调 OpenGL 都要走回 JS 到 WebGL，性能未必有保证等
- 感觉不会
  - 从企业来看，不会。增加人员薪资成本，开发效率低
  - 从开发者个人来看，在这个卷的不能再卷的行业，大家也不想放弃之前的技术生态圈，去干费劲不讨好的事
  - 在历史进程来看，个体强不如群体强，js生态会繁荣发展下去的
- 我认为WASM不会取代JS，相反会更丰富JS的生态圈。
  - 不说长期，但现在短期现在已经开始取代很多node.js的C++扩展了。
  - 包括本人也是极力推荐只要非强依赖V8引擎的C++扩展都用WASM来做。这样的好处有很多。
  - 不会因为V8的升级和Node版本导致扩展不可用。
  - 摆脱对node.js的依赖，浏览器直接就可以跑。即使以后升级到deno一样可用。
  - 不需要在不同环境编译，开发过C++扩展的就知道，经常性导致不同环境（尤其是不同Linux发行版）缺少依赖以至于编译失败。
  - 兼容性好不会因为win和Linux的方法不同而和CPU指令集（ARM和x86之争）不同无法运行。
  - 所以目前短期来看都是在丰富JS语言能力。
    - 而且使用其它语言包括rust，golang，java，c++你会发现编译WASM给JS写方法很方便，而全部用非js语言来开法非常麻烦。
    - 而这些都是在丰富JS库，以及方便移植的其它语言代码。
    - 所以后续难保不会出现clickhouse.js,docker.js，k8s.js。
  - 长期来说开发估计还是少不了JS，只不过上线可能会全部转换为WASM了。
- 后面JavaScript会被编译为webAssembly提速。这叫取代了吗？

- ### [Reason, ClojureScript, AssemblyScript 你更看好哪门语言的未来？](https://www.zhihu.com/question/347763134/answers/updated)
- 目前完全没有想清楚它的抽象高度到底在哪
  - 是想做一门高级语言，还是Wasm的一个带糖语法？
  - 现在这种不上不下的时候就号称它是 TS 的严格子集完全自己打自己脸，而且即使他加了更多高级的语言结构，我也担心它会掉入「恐怖谷理论」（即越像时越发现不像）与 leaky abstraction 的问题里。
- WebAssembly 的 GC proposal 还没定下来，现在自己直接带 GC 到 Wasm 的 linear memory 上只是暂时的解决方案，在 GC 的实现和与 JS 的互交互上有不少问题。
  - 也就是说managed语言（不包括 C/C++/Rust）编译到 WebAssembly 的这场仗根本就还没开始
  - 正式玩家都还没上线呢，AssemblyScript 现在玩的就是个内测
- 我认为所有能弄成wasm的非JS(非带GC的)语言目前都是有潜力的。
  - 最后谁更胜一筹，估计会取决于一些随机的市场因素。
  - 事实证明，一门语言是否成功，跟这门语言是否先进，根本一点关系都没有。
  - 勉强能说得上有关系的，就是爹要有钱。

- ### [有哪些效果拔群的 WebAssembly 应用？](https://www.zhihu.com/question/265700379/answers/updated)
- 计算机视觉方面
  - 基于Web端的图像检测与跟踪
  - 基于Web端的人脸关键点检测与跟踪
- 视频解码方面
- AutoCad web版本
- 作为 tensorflow.js 的可选后端之一，默认实现为 WebGL
  - 另外 WebGPU 很值得关注！
  - 这种大量的并行计算，还是gpu加速来吧。
- 我来举用和不用 WASM 的两个【复杂前端应用】的例子，它们都有大量的活跃用户。
  - Figma 大有取代 Sketch 之势，它就重度使用了 WASM
  - 虽然 Figma 的外围控件 UI 是 HTML + CSS 的，但核心的交互界面则在一个 Canvas 内承载，不难发现这个 Canvas 是使用 WebGL 的
  - 中间这整个 Canvas 的交互明显是 WASM 控制的。外围控件平台独立 UI + 核心编辑区域 WASM，这种架构设计是值得借鉴的。
  - 推荐一个在浏览器里运行的全功能 Photoshop，亦即稿定PS
    - Photopea 所有的代码都是 JavaScript，没有任何 WASM 成分
    - 我就此专门问过 Ivan 的想法，按他的说法，用 JS 重写那些 C++ 的底层代码，对他来说往往比费力把这些库接进来更方便
    - Photopea 从字体二进制解析、算法处理、渲染到图像编码导出，几乎都是他自己 JavaScript 徒手撸的。
    - 另外，一些 AI 抠图等需要训练模型的地方，未来也可能引入 WASM。
  - 所以基本上，效果拔群的 Web 应用，关键倒不是选 JavaScript 还是 WASM，而是**掌握对渲染的极致控制**。
    - 当你有了这个水平之后，是否使用 WASM 也只是一种选择而已
