---
title: note-engineering
created: '2019-06-18T09:56:43.623Z'
modified: '2019-07-03T05:25:04.524Z'
tags: [engineering]
---

# note-engineering   
软件工程与架构  

## refactor

### 重构原则
- 经典6大原则：开闭、接口隔离、单一职责、里氏替换、依赖倒置、迪米特法则
- 对外接口要兼容
- 不修改和第三方交互的接口参数，必需和原来保持一致
- 对外服务的URL保持不变
- 遵循团队或通用的代码规范

### 重构的方法
- 重构基本策略
    - 本地开发运行、重构、部署
    - 在核心业务代码的入口开始测试，逐步延伸到其他模块
    - 阅读源码
        - 边阅读边记录疑问，疑问会自动解决
        - 记录重要bug
        - 记录改进想法
    - 测试 -> 小修改 -> 测试 -> 小修改
- 业务理解与优化
    - 统一业务数据模型 
- 代码优化方法
    - 先提取重复代码到单独方法、抽象类、工具类
    - 再分割冗长方法，可以按子功能或步骤分割，考虑按业务功能分割
    - 业务需求经常变更的地方考虑提炼方法
    - 使用卫语句重构嵌套条件分支
    - 嵌套条件分支尝试合并分支
    - 替换过长参数列表为对象
    - 使用多态取代多分支条件逻辑
    - 提取类或继承体系中的magic number和其他状态数据，替换为常量值或枚举值
    - 类中方法优化，合并、分解、增加
    - 类中属性成员过多时，考虑拆分类，优先通过组合而不是继承
    - final化类和方法，java编译器会内联方法
    - 尽量使用局部变量
    - for循环中条件尽量不用使用类似size()的计算，先把值计算出来
    - 字符串拼接不用+，使用StringBuilder/StringBuffer
    - 提取继承体系中的重复属性和方法成员到父类
    - 尝试设计模式来重构模块
        - 工厂
        - 适配器
        - 建造者
        - 观察者
        - 监听器
        - 代理
        - 职责链
        - 装饰器
    - 抽象通用功能、通用模块
    - 使用容器集合时，指定初始空间，特别是如果变化比较大且频繁
    - 对象比较的时候常量放前面，减少空指针
    - 当复制大量数据时最好使用System.arrayCopy()方法，太小的话使用for循环比较快
    -使用带缓冲的输入输出流进行IO操作：BufferedReader、BufferedInputStream / BufferedWriter、BufferedOutputStream
    - 基本类型转换为字符串，最快的使用.toString()
    - 遍历map对应的key-value，最好使用iterator的EntrySet方式；如果只是使用key值，则使用 hm.keySet();更加合理
    - 多使用一些apache下提供的包：StringUtils、Collections判空、Arrays转换list，或者使用Guava：Joiner、Splitter、Strings、Maps判空
    - later：去掉一次性的临时变量
- 性能优化方法
    - 高频率接口执行速度优化
        - 从s降低到ms
        - 通过建立索引来优化
    - 懒加载
    - 循环内尽量不要try-catch
    - 循环内尽量不要创建对象
    - 乘法、除法尽量使用位运算
    - 使用数据库连接池
    - 使用线程池
- 安全及运维优化方法
    - 升级依赖
    - 监控指标设计
    - 提高安全性
        - 设置ip白名单
        - 增加请求参数校验
    - 关键信息或异常状态发送到运维平台
    - 加强异常处理，如npe、数组越界
- 数据库优化方法
    - 坚决避免，查全表数据或者数量大的数据，避免内存溢出，可改成分页
    - 和别的服务公用表的数据考虑独立
    - 陈旧历史数据分离及备份
    - 添加索引

### 通用功能
- 加载数据
- 动态构建bean
- 事件函数


